/*
 *  x-tree-select - v2.1.1
 *  Tree select for jquery.
 *  
 *
 *  Made by 4xmen
 *  Under GPL-3.0 License
 */
!function(a){"use strict";a.fn.treeSelect=function(b){a.treeselect_animation={none:"","x-flip":"anim xout",fade:"xfade",slide:"xslide"},void 0===a.xtsStore&&(a.scbCounter=-1,a.xtsStore=[],a.currentCounter=0),a.xts=this;var c=a.extend({datatree:[],transition:"fade",direction:"ltr",onOpen:function(){},onSelect:function(a){},onChange:function(a,b){},onClose:function(){},selectablePrernt:!1,mainTitle:"Main category",json:{title:"title",value:"value",child:"child"},searchable:!1},b);return a.navigatex=[],a.lastx={title:"",id:""},this.target=null,this.text=null,a.scbCounter++,a.xtsStore[a.scbCounter]=c,this.init=function(b){a.lastx.title=c.mainTitle,a(b).hide();var d="Please select";void 0!==a(b).attr("placeholder")&&(d=a(b).attr("placeholder"));var e="";"rtl"===a.xtsStore[a.scbCounter].direction&&(e="xts-rtl"),a(b).parent().append('<div class="xtsel '+e+'" data-trcounter="'+a.scbCounter+'" >'+d+"</div>"),c.datatree=a.xts.makeId("1",c.datatree),a(b).parent().find(".xtsel").bind("click.open",function(c){if(c.target===this){var d=a(this);if(!d.hasClass("loading"))if(d.addClass("loading"),setTimeout(function(){d.removeClass("loading")},600),a.currentCounter=a(this).data("trcounter"),a.lastx.title=a.xtsStore[a.currentCounter].mainTitle,a(this).hasClass("active")){if(c.target!==this)return;a(this).removeClass("active"),a("#xtsel-list").slideUp(100,function(){a(this).remove()})}else{if(a.xtsStore[a.currentCounter].onOpen(),a.xtsStore[a.currentCounter].searchable){var e=' class="xts-searcable" ';a(document).on("keyup","#xtsel-list .srch",function(){var b=a(this).closest(".xtsel").data("trcounter"),c=a(this).val();if(0==c.length)return a.xts.showTree(a.xtsStore[b].datatree),a("#xtsel-list .srch").focus(),!1;var d=a.xts.searchShow(b,c,a.xtsStore[b].datatree);a("#xtsel-list .xli").remove(),a("#xtsel-list").append(d)})}else var e="";a.xts.target=a(this).parent().find("input"),a.xts.text=a(b).parent().find(".xtsel"),a(this).append("<ul"+e+' id="xtsel-list"></ul>'),void 0===a.xtsStore[a.currentCounter].navx?a.xts.showTree(a.xtsStore[a.currentCounter].datatree):(a.lastx=a.xtsStore[a.currentCounter].lastx,a.navigatex=a.xtsStore[a.currentCounter].navx,a.xts.showTree(a.xts.findTree(a.xtsStore[a.currentCounter].datatree,a.xtsStore[a.currentCounter].lastx.id))),a("#xtsel-list").slideDown(function(){a(document).bind("click.handvarrsl",function(b){return a(b.target).is(".xtsel-childer, .xtsel-back, .search, .srch")||(a.xts.resetClose(),a("#xtsel-list").slideUp(200,function(){a(this).remove()}),a(a.xts.text).removeClass("active")),b.preventDefault(),!1})}),a(this).addClass("active")}}}),a(document).off("click","#xtsel-list li"),a(document).on("click","#xtsel-list li",function(b){if(a(this).hasClass("xtsel-childer")&&!a(b.target).hasClass("xtsel-selectable")){var c={title:a.lastx.title,id:a.lastx.id};a.navigatex.push(c),a.lastx.title=a(this).text(),a.lastx.id=a(this).data("id"),a("#xtsel-list").addClass(a.treeselect_animation[a.xtsStore[a.currentCounter].transition]);var d=this;setTimeout(function(){a.xts.showTree(a.xts.findTree(a.xtsStore[a.currentCounter].datatree,a(d).data("id"))),a("#xtsel-list").removeClass(a.treeselect_animation[a.xtsStore[a.currentCounter].transition])},600)}else if(a(this).hasClass("xtsel-back")){void 0!==a.navigatex[a.navigatex.length-1]?(a.lastx.title=a.navigatex[a.navigatex.length-1].title,a.lastx.id=a.navigatex[a.navigatex.length-1].id):(a.lastx.title=a.xtsStore[a.currentCounter].mainTitle,a.lastx.id=""),a.navigatex.pop();var e=a.xts.findTree(a.xtsStore[a.currentCounter].datatree,a(this).data("id"));a("#xtsel-list").addClass(a.treeselect_animation[a.xtsStore[a.currentCounter].transition]);setTimeout(function(){0===e.length?a.xts.showTree(a.xtsStore[a.currentCounter].datatree):a.xts.showTree(e),a("#xtsel-list").removeClass(a.treeselect_animation[a.xtsStore[a.currentCounter].transition])},600)}else a(b.target).hasClass("search")||a(b.target).hasClass("srch")||(a.xtsStore[a.currentCounter].onChange({value:a(a.xts.target).val(),text:a(a.xts.text).clone().children().remove().end().text()},{value:a(this).data("value"),text:a(this).text()}),a(a.xts.target).val(a(this).data("value")),a(a.xts.text).text(a(this).text()),a.navigatex.length>0?(a.xtsStore[a.currentCounter].navx=a.navigatex,a.xtsStore[a.currentCounter].lastx=a.lastx):(delete a.xtsStore[a.currentCounter].navx,delete a.xtsStore[a.currentCounter].lastx),a(a.xts.text).removeClass("active"),a.xtsStore[a.currentCounter].onSelect({value:a(this).data("value"),text:a(this).text(),id:a(this).data("id"),parent:a.lastx,ancestors:a.navigatex}),a("#xtsel-list").slideUp(100,function(){a(this).remove()}))}),void 0!=a(b).attr("value")&&""!=a(b).val()&&null!=a(b).val()&&this.setDefault(a.scbCounter,a(b).val())},this.makeId=function(b,c){var d=[];for(var e in c){var f=c[e],g=b+"-"+(parseInt(e)+1);f.idx=g,void 0===f[a.xtsStore[a.scbCounter].json.child]&&(f[a.xtsStore[a.scbCounter].json.child]=[]),0!==f[a.xtsStore[a.scbCounter].json.child].length&&(f[a.xtsStore[a.scbCounter].json.child]=a.xts.makeId(g,f[a.xtsStore[a.scbCounter].json.child])),d.push(f)}return d},this.showTree=function(b,c){var d="";if(a("#xtsel-list li").remove(),0!==a.navigatex.length){var e=a.navigatex[a.navigatex.length-1];d+='<li class="xtsel-back" data-id="'+e.id+'"> &nbsp;'+e.title+"</li>"}else d+='<li class="search"> <input type="search" class="srch" placeholder="search..." value=""> </li>';for(var f in b){var g=b[f],h=' class="xli xtsel-childer"',i="";0===g[a.xtsStore[a.currentCounter].json.child].length?h=' class="xli"':a.xtsStore[a.currentCounter].selectablePrernt&&(i='<span class="xtsel-selectable"></span>'),d+="<li"+h+' data-id="'+g.idx+'"  data-value="'+g[a.xtsStore[a.currentCounter].json.value]+'">'+i+g[a.xtsStore[a.currentCounter].json.title]+"</li>"}a("#xtsel-list").html(d),void 0!==c&&c()},this.findTree=function(b,c){var d=[];for(var e in b){var f=b[e];if(f.idx===c)return f[a.xtsStore[a.currentCounter].json.child]}for(var e in b){var f=b[e];if(0!==f[a.xtsStore[a.currentCounter].json.child].length){var g=a.xts.findTree(f[a.xtsStore[a.currentCounter].json.child],c);if(0!==g.length)return g}}return d},this.findItem=function(b,c,d,e){e=e||null,null!=e?a.navigatex.push({id:e.idx,title:e[a.xtsStore[d].json.title]}):(a.navigatex.push({id:"",title:a.xtsStore[d].mainTitle}),a.lastx.title=a.xtsStore[d].mainTitle,a.lastx.id="");for(var f in b){var g=b[f];if(g[a.xtsStore[d].json.value]==c)return g;if(void 0!=g[a.xtsStore[d].json.child]&&g[a.xtsStore[d].json.child].length>0){a.lastx={id:g.idx,title:g[a.xtsStore[d].json.title]};var h=this.findItem(g[a.xtsStore[d].json.child],c,d,g);if(0!=h)return h}}return a.navigatex.pop(),!1},this.searchShow=function(b,c,d){var e="",f="";a.xtsStore[b].selectablePrernt&&(f='<span class="xtsel-selectable"></span>');for(var g in d){var h=' class="xli" ',i=d[g];-1!==i[a.xtsStore[b].json.title].toString().indexOf(c)||-1!==i[a.xtsStore[b].json.value].toString().indexOf(c)?void 0!=i[a.xtsStore[b].json.child]&&i[a.xtsStore[b].json.child].length>0?(h=' class="xli xtsel-childer" ',e+="<li"+h+' data-id="'+i.idx+'"  data-value="'+i[a.xtsStore[b].json.value]+'">'+f+i[a.xtsStore[b].json.title]+"</li>",e+=a.xts.searchShow(b,c,i[a.xtsStore[b].json.child])):e+="<li"+h+' data-id="'+i.idx+'"  data-value="'+i[a.xtsStore[b].json.value]+'">'+i[a.xtsStore[b].json.title]+"</li>":void 0!=i[a.xtsStore[b].json.child]&&i[a.xtsStore[b].json.child].length>0&&(e+=a.xts.searchShow(b,c,i[a.xtsStore[b].json.child]))}return e},this.setDefault=function(b,c){var d=a.xts.findItem(a.xtsStore[b].datatree,c,b);0!=d&&(a.xtsStore[b].lastx=a.lastx,a.navigatex.pop(),a.xtsStore[b].navx=a.navigatex,a("[data-trcounter='"+b+"']").text(d[a.xtsStore[b].json.title]))},this.resetClose=function(){a.xtsStore[a.currentCounter].onClose(),a.navigatex=[],a.lastx={title:a.xtsStore[a.currentCounter].mainTitle,id:""},a(document).unbind("click.handvarrsl"),a(document).off("keyup","#xtsel-list .srch")},this.setValue=function(a){var b=this.html();this.html(b+" "+a)},this.each(function(){a.xts.init(this)}),this}}(jQuery);
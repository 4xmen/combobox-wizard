/*
 *  tree-select - v4.1.0
 *  Tree select for jquery.
 *  
 *
 *  Made by 4xmen
 *  Under MIT License
 */
!function(a){"use strict";a.fn.treeSelect=function(b){void 0==a.wcbStore&&(a.scbCounter=-1,a.wcbStore=[],a.currentCounter=0),a.wcb=this;var c=a.extend({datatree:[],direction:"ltr",onOpen:function(){},OnSelect:function(a){},OnChange:function(a,b){},onClose:function(){},mainTitle:"Main category",json:{title:"title",value:"value",child:"child"}},b);return a.navigatex=[],a.lastx={title:"",id:""},this.target=null,this.text=null,a.scbCounter++,a.wcbStore[a.scbCounter]=c,this.init=function(b){a.lastx.title=c.mainTitle,a(b).hide();var d="Please select";if(void 0!=a(b).attr("placeholder")&&(d=a(b).attr("placeholder")),"rtl"==a.wcbStore[a.scbCounter].direction)var e="wcb-rtl";else var e="";a(b).parent().append('<div class="wzcmb '+e+'" data-wcounter="'+a.scbCounter+'" >'+d+"</div>"),c.datatree=a.wcb.makeId("1",c.datatree),a(b).parent().find(".wzcmb").bind("click.open",function(c){if(c.target===this)if(a.currentCounter=a(this).data("wcounter"),a.lastx.title=a.wcbStore[a.currentCounter].mainTitle,a(this).hasClass("active")){if(c.target!==this)return;a(this).removeClass("active"),a("#wzcmb-list").slideUp(100,function(){a(this).remove()})}else a.wcbStore[a.currentCounter].onOpen(),a.wcb.target=a(this).parent().find("input"),a.wcb.text=a(b).parent().find(".wzcmb"),a(this).append('<ul id="wzcmb-list"></ul>'),a.wcb.showTree(a.wcbStore[a.currentCounter].datatree),a("#wzcmb-list").slideDown(function(){a(document).bind("click.handlewsc",function(b){return a(b.target).is(".wzcmb-childer, .wzcmb-back")||(a.wcb.resetClose(),a("#wzcmb-list").slideUp(200,function(){a(this).remove()}),a(a.wcb.text).removeClass("active")),b.preventDefault(),!1})}),a(this).addClass("active")}),a(document).off("click","#wzcmb-list li"),a(document).on("click","#wzcmb-list li",function(){if(a(this).hasClass("wzcmb-childer")){var b={title:a.lastx.title,id:a.lastx.id};a.navigatex.push(b),a.lastx.title=a(this).text(),a.lastx.id=a(this).data("id"),a("#wzcmb-list").addClass("anim out"),a.wcb.showTree(a.wcb.findTree(a.wcbStore[a.currentCounter].datatree,a(this).data("id")));setTimeout(function(){a("#wzcmb-list").removeClass("anim out")},500)}else if(a(this).hasClass("wzcmb-back")){void 0!=a.navigatex[a.navigatex.length-1]?(a.lastx.title=a.navigatex[a.navigatex.length-1].title,a.lastx.id=a.navigatex[a.navigatex.length-1].id):(a.lastx.title=a.wcbStore[a.currentCounter].mainTitle,a.lastx.id=""),a.navigatex.pop();var c=a.wcb.findTree(a.wcbStore[a.currentCounter].datatree,a(this).data("id"));a("#wzcmb-list").addClass("anim out"),0==c.length?a.wcb.showTree(a.wcbStore[a.currentCounter].datatree):a.wcb.showTree(c);setTimeout(function(){a("#wzcmb-list").removeClass("anim out")},500)}else a.wcbStore[a.currentCounter].OnChange({value:a(a.wcb.target).val(),text:a(a.wcb.text).clone().children().remove().end().text()},{value:a(this).data("value"),text:a(this).text()}),a(a.wcb.target).val(a(this).data("value")),a(a.wcb.text).text(a(this).text()),a(a.wcb.text).removeClass("active"),a.wcbStore[a.currentCounter].OnSelect({value:a(this).data("value"),text:a(this).text()}),a("#wzcmb-list").slideUp(100,function(){a(this).remove()})})},this.makeId=function(b,c){var d=[];for(var e in c){var f=c[e],g=b+"-"+(parseInt(e)+1);f.idx=g,0!=f[a.wcbStore[a.scbCounter].json.child].length&&(f[a.wcbStore[a.scbCounter].json.child]=a.wcb.makeId(g,f[a.wcbStore[a.scbCounter].json.child])),d.push(f)}return d},this.showTree=function(b,c){var d="";if(a("#wzcmb-list li").remove(),0!==a.navigatex.length){var e=a.navigatex[a.navigatex.length-1];d+='<li class="wzcmb-back" data-id="'+e.id+'"> &nbsp;'+e.title+"</li>"}for(var f in b){var g=b[f];if(0==g[a.wcbStore[a.currentCounter].json.child].length)var h=' class=""';else var h=' class="wzcmb-childer"';d+="<li"+h+' data-id="'+g.idx+'"  data-value="'+g[a.wcbStore[a.currentCounter].json.value]+'">'+g[a.wcbStore[a.currentCounter].json.title]+"</li>"}a("#wzcmb-list").html(d),void 0!==c&&c()},this.findTree=function(b,c){var d=[];for(var e in b){var f=b[e];if(f.idx==c)return f[a.wcbStore[a.currentCounter].json.child]}for(var e in b){var f=b[e];if(0!==f[a.wcbStore[a.currentCounter].json.child].length){var g=a.wcb.findTree(f[a.wcbStore[a.currentCounter].json.child],c);if(0!==g.length)return g}}return d},this.resetClose=function(){a.wcbStore[a.currentCounter].onClose(),a.navigatex=[],a.lastx={title:a.wcbStore[a.currentCounter].mainTitle,id:""},a(document).unbind("click.handlewsc")},this.setValue=function(a){var b=this.html();this.html(b+" "+a)},this.each(function(){a.wcb.init(this)}),this}}(jQuery);